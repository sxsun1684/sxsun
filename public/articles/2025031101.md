# Flask + AWS DynamoDB + .env

# **é…ç½®æœ€ä½³å®è·µ**

## **ğŸ“Œ èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆè¦å†™è¿™ä»½æŒ‡å—ï¼Ÿ**

åœ¨ä½¿ç”¨ **Flask + AWS DynamoDB** è¿›è¡Œå¼€å‘æ—¶ï¼Œæˆ‘ä»¬é‡åˆ°äº†å¤šä¸ªé—®é¢˜ï¼ŒåŒ…æ‹¬ï¼š

- **`.env` æ–‡ä»¶è§£æå¤±è´¥** (`Python-dotenv could not parse statement`)
- **DynamoDB è¿æ¥å¤±è´¥** (`botocore.exceptions.EndpointConnectionError`)
- **DynamoDB é‡æ–°åˆ›å»ºè¡¨åï¼ŒFlask ä»ç„¶æ— æ³•å†™å…¥æ•°æ®**
- **AWS æ§åˆ¶å°æ•°æ®æ›´æ–°å»¶è¿Ÿï¼Œå¯¼è‡´è¯¯ä»¥ä¸ºæ•°æ®å†™å…¥å¤±è´¥**
- **Flask `put_item()` æ‰§è¡ŒæˆåŠŸä½† DynamoDB æ²¡æœ‰æ›´æ–°**

è¿™ä»½æ–‡æ¡£æ€»ç»“äº†æ‰€æœ‰è¸©å‘ç»éªŒï¼Œå¸®åŠ©å¼€å‘è€…æ­£ç¡®é…ç½® **Flask API + AWS DynamoDB + `.env`**ï¼Œå¹¶æä¾›ä¸€å¥—å®Œæ•´çš„æ’æŸ¥æ–¹æ¡ˆã€‚ ğŸš€

---

# **1ï¸âƒ£ Python-dotenv è§£æ `.env` æ–‡ä»¶å¤±è´¥çš„è§£å†³æ–¹æ¡ˆ**

### **âŒ é”™è¯¯ä¿¡æ¯**

```bash
Python-dotenv could not parse statement starting at line 3
Python-dotenv could not parse statement starting at line 6

```

### **ğŸ“Œ å¯èƒ½çš„åŸå› **

- `.env` æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼Œä¾‹å¦‚ï¼š
    
    ```
    AWS_ACCESS_KEY_ID = "XXXXXXXXX"  # âŒ ä¸åº”æœ‰ç©ºæ ¼
    AWS_SECRET_ACCESS_KEY: YYYYYYYYYY  # âŒ ä¸åº”ä½¿ç”¨ `:`
    ``
    
    ```
    
    - AWS_REGION="us-west-1 # âŒ å¼•å·ä¸åŒ¹é…
    
    ```
    
    ```
    

### **âœ… è§£å†³æ–¹æ¡ˆ**

**1. ç¡®ä¿ `.env` æ–‡ä»¶æ ¼å¼æ­£ç¡®**

```
AWS_ACCESS_KEY_ID=XXXXXXXXXXX
AWS_SECRET_ACCESS_KEY=YYYYYYYYYYY
AWS_REGION=us-west-1
DYNAMODB_TABLE=Users
DEBUG=True
PORT=5050

```

ğŸ“Œ **æ³¨æ„**ï¼š

- `KEY=VALUE` ä¹‹é—´ä¸èƒ½æœ‰ **ç©ºæ ¼**
- ä¸èƒ½ä½¿ç”¨ `:`
- `"` éœ€è¦æˆå¯¹åŒ¹é…

**2. æ£€æŸ¥ `.env` æ–‡ä»¶æ˜¯å¦æœ‰éšè—å­—ç¬¦**

```bash
cat -A .env  # æ£€æŸ¥æ¢è¡Œç¬¦ç­‰éšè—å­—ç¬¦

```

å¦‚æœå‘ç° `^M` æˆ– `\r\n`ï¼Œè¯´æ˜ `.env` æ˜¯ Windows æ ¼å¼ï¼Œä¿®å¤æ–¹å¼ï¼š

```bash
dos2unix .env  # ä»…é€‚ç”¨äº Linux/macOS

```

**3. ç¡®ä¿ Flask ä»£ç æ­£ç¡®åŠ è½½ `.env`**

```python
from dotenv import load_dotenv
import os

load_dotenv()

AWS_ACCESS_KEY_ID = os.getenv("AWS_ACCESS_KEY_ID")
AWS_REGION = os.getenv("AWS_REGION", "us-west-1")
DYNAMODB_TABLE = os.getenv("DYNAMODB_TABLE", "Users")

print("AWS_ACCESS_KEY_ID:", AWS_ACCESS_KEY_ID)
print("DYNAMODB_TABLE:", DYNAMODB_TABLE)

```

è¿è¡Œ `python server.py`ï¼Œå¦‚æœ `.env` é…ç½®æ­£ç¡®ï¼Œç¯å¢ƒå˜é‡åº”è¯¥æˆåŠŸæ‰“å°ã€‚

---

# **2ï¸âƒ£ Flask è¿æ¥ AWS DynamoDB å¤±è´¥çš„è§£å†³æ–¹æ¡ˆ**

### **âŒ å¸¸è§é”™è¯¯ä¿¡æ¯**

```bash
botocore.exceptions.EndpointConnectionError: Could not connect to the endpoint URL

```

```bash
botocore.exceptions.NoCredentialsError: Unable to locate credentials

```

### **ğŸ“Œ å¯èƒ½çš„åŸå› **

- AWS `region_name` é…ç½®é”™è¯¯
- `AWS_ACCESS_KEY_ID` / `AWS_SECRET_ACCESS_KEY` ä¸ºç©º
- Flask è¿æ¥çš„æ˜¯æœ¬åœ° DynamoDBï¼Œè€Œä¸æ˜¯ AWS äº‘ç«¯
- IAM è§’è‰²æ²¡æœ‰ `AmazonDynamoDBFullAccess` æƒé™

### **âœ… è§£å†³æ–¹æ¡ˆ**

**1. ç¡®ä¿ DynamoDB è¿æ¥ä¿¡æ¯æ­£ç¡®**

```python
import boto3

dynamodb = boto3.resource(
    "dynamodb",
    region_name="us-west-1"  # ç¡®ä¿å’Œ AWS æ§åˆ¶å°ä¸€è‡´
)

```

**2. ç¡®ä¿ AWS å‡­è¯å·²æ­£ç¡®é…ç½®**
è¿è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ AWS å‡­è¯ï¼š

```bash
aws sts get-caller-identity

```

å¦‚æœè¿”å› `InvalidClientTokenId`ï¼Œéœ€è¦é‡æ–°é…ç½® AWS CLIï¼š

```bash
aws configure

```

**3. ä½¿ç”¨ `list_tables()` ç¡®ä¿ DynamoDB è¿æ¥æ­£å¸¸**

```python
client = boto3.client("dynamodb", region_name="us-west-1")
print(client.list_tables())

```

å¦‚æœè¿”å› `[]`ï¼Œè¯´æ˜ AWS è´¦æˆ·ä¸‹ **æ²¡æœ‰ DynamoDB è¡¨**ï¼Œæ£€æŸ¥ AWS æ§åˆ¶å°ã€‚

---

# **3ï¸âƒ£ DynamoDB é‡æ–°åˆ›å»ºè¡¨åï¼ŒFlask ä»ç„¶æ— æ³•å†™å…¥**

### **âŒ é—®é¢˜**

- é‡æ–°åˆ›å»ºäº† **åŒåçš„ DynamoDB è¡¨**ï¼Œä½† Flask ä»ç„¶æŠ¥ `ResourceNotFoundException`
- **Postman è¯·æ±‚æˆåŠŸï¼Œä½† DynamoDB æ§åˆ¶å°çœ‹ä¸åˆ°æ•°æ®**
- DynamoDB æ§åˆ¶å°æç¤º `æ•°æ®æ›´æ–°å¤§çº¦æ¯ 6 å°æ—¶`ï¼Œä½† `scan()` æŸ¥ä¸åˆ°æ•°æ®

### **âœ… è§£å†³æ–¹æ¡ˆ**

**1. é‡æ–°åŠ è½½è¡¨ï¼Œé¿å… `boto3` ç¼“å­˜æ—§è¡¨ä¿¡æ¯**

```python
import boto3

dynamodb = boto3.resource("dynamodb", region_name="us-west-1")
table = dynamodb.Table("Users")

# å¼ºåˆ¶åˆ·æ–°è¡¨ä¿¡æ¯
table.load()
print("Table Status:", table.table_status)

```

**2. ç›´æ¥ç”¨ `scan()` æˆ– `query()` æŸ¥è¯¢æ•°æ®**

```python
response = table.scan()
print(f"DynamoDB è®°å½•æ•°: {len(response['Items'])}")

```

---

# **4ï¸âƒ£ Postman ç«¯ç‚¹æµ‹è¯• Flask API**

**æµ‹è¯• API æ˜¯å¦è¿æ¥æˆåŠŸ**

```python
from flask import Flask, jsonify

app = Flask(__name__)

@app.route('/test-db', methods=['GET'])
def test_db():
    try:
        response = table.scan()
        return jsonify({"message": "âœ… è¿æ¥æˆåŠŸ", "users_count": len(response["Items"])})
    except Exception as e:
        return jsonify({"message": "âŒ è¿æ¥å¤±è´¥", "error": str(e)}), 500

if __name__ == '__main__':
    app.run(port=5050, debug=True)

```

ğŸ“Œ **åœ¨ Postman é‡Œæµ‹è¯•**:

```
GET http://127.0.0.1:5050/test-db

```

âœ… **å¦‚æœè¿”å› `users_count`ï¼Œè¯´æ˜ Flask æˆåŠŸè¿æ¥ AWS DynamoDBï¼**

---

# **ğŸ¯ ç»“è®º**

- **ç¡®ä¿ `.env` æ ¼å¼æ­£ç¡®**ï¼Œé¿å… `Python-dotenv` è§£æå¤±è´¥
- **æ£€æŸ¥ `AWS_REGION` æ˜¯å¦å’Œ DynamoDB æ§åˆ¶å°ä¸€è‡´**
- **DynamoDB é‡æ–°åˆ›å»ºè¡¨åï¼Œåˆ·æ–° `boto3` ç¼“å­˜**
- **ä½¿ç”¨ `scan()` æˆ– `query()` ç¡®è®¤æ•°æ®å†™å…¥æˆåŠŸ**
- **ç”¨ Postman æµ‹è¯• Flask APIï¼Œç¡®ä¿ DynamoDB è¿æ¥æ­£å¸¸**

è¿™æ ·å¯ä»¥é¿å… DynamoDB è¿æ¥å’Œ `.env` é…ç½®çš„å¸¸è§é—®é¢˜ï¼ ğŸš€